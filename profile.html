
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Profile</title>
  <style>
:root {
  --primary: #3498db;
  --primary-light: #3a86ff;
  --primary-dark: #3f37c9;
  --secondary: #4cc9f0;
  --success: #4ade80;
  --danger: #f87171;
  --warning: #fbbf24;
  --info: #60a5fa;
  --light: #f8f9fa;
  --dark: #212529;
  --gray: #6c757d;
  --light-gray: #e9ecef;
  --white: #ffffff;
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  --rounded-sm: 0.25rem;
  --rounded: 0.5rem;
  --rounded-md: 0.75rem;
  --rounded-lg: 1rem;
  --transition: all 0.3s ease;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  background-color: #f5f7fb;
  padding-top: 70px;
  color: var(--dark);
  line-height: 1.6;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  line-height: 1.3;
  color: var(--dark);
  margin-bottom: 1rem;
}

h1 { font-size: 2rem; }
h2 { font-size: 1.75rem; }
h3 { font-size: 1.5rem; }
h4 { font-size: 1.25rem; }

p {
  margin-bottom: 1rem;
  color: var(--gray);
}

a {
  color: var(--primary);
  text-decoration: none;
  transition: var(--transition);
}

a:hover {
  color: var(--primary-dark);
  text-decoration: underline;
}

/* Navbar */
.navbar {
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 5%;
  background-color: var(--white);
  box-shadow: var(--shadow);
  transition: var(--transition);
}

.navbar.scrolled {
  padding: 0.75rem 5%;
  background-color: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(5px);
}

.logo {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 1.5rem;
}

.nav-links a {
  text-decoration: none;
  color: var(--dark);
  font-weight: 500;
  padding: 0.5rem 1rem;
  border-radius: var(--rounded-sm);
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.nav-links a:hover {
  background-color: rgba(67, 97, 238, 0.1);
  color: var(--primary);
}

.nav-links a.active {
  background-color: var(--primary);
  color: var(--white);
}

.profile-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background-color: var(--primary);
  color: var(--white);
  cursor: pointer;
  transition: var(--transition);
}

.profile-icon:hover {
  background-color: var(--primary-dark);
  transform: scale(1.05);
}

.mobile-menu {
  display: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--dark);
}

/* Main Content */
.profile-container {
  max-width: 1200px;
  margin: 2rem auto;
  background: var(--white);
  padding: 2.5rem;
  border-radius: var(--rounded-lg);
  box-shadow: var(--shadow);
}

/* Profile Section */
.circular-img {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid var(--light-gray);
  margin: 0 auto 2rem;
  display: block;
  box-shadow: var(--shadow-sm);
  transition: var(--transition);
}

.circular-img:hover {
  transform: scale(1.02);
  box-shadow: var(--shadow);
}

.section {
  padding: 1.5rem;
  background-color: var(--white);
  border-radius: var(--rounded-md);
  margin-bottom: 2rem;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--light-gray);
}

.info-group {
  margin: 1rem 0;
  font-size: 1rem;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
}

.info-label {
  width: 180px;
  font-weight: 600;
  color: var(--dark);
}

.info-value {
  flex: 1;
  color: var(--gray);
}

/* Buttons */
button, .btn {
  padding: 0.625rem 1.25rem;
  border-radius: var(--rounded-sm);
  font-weight: 500;
  font-size: 0.875rem;
  cursor: pointer;
  transition: var(--transition);
  border: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

button:hover, .btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

button:active, .btn:active {
  transform: translateY(0);
}

button:focus, .btn:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.3);
}

#editBtn, #doneBtn, .edit-btn {
  background-color: var(--primary);
  color: var(--white);
}

#editBtn:hover, #doneBtn:hover, .edit-btn:hover {
  background-color: var(--primary-dark);
}

.done-btn {
  background-color: var(--success);
  color: var(--white);
}

.done-btn:hover {
  background-color: #22c55e;
}

.delete-btn, #deleteBtn {
  background-color: var(--danger);
  color: var(--white);
}

.delete-btn:hover, #deleteBtn:hover {
  background-color: #ef4444;
}

/* Forms and Lists */
.form-list {
  list-style: none;
  padding: 0;
  margin: 0 0 2rem;
}

.form-item {
  margin-bottom: 1rem;
  background: var(--light);
  padding: 1rem 1.5rem;
  border-left: 4px solid var(--primary);
  border-radius: var(--rounded-sm);
  transition: var(--transition);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.form-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}

.form-item a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 600;
  flex: 1;
}

.form-item span {
  display: block;
  font-size: 0.875rem;
  color: var(--gray);
}

.no-data {
  color: var(--gray);
  font-style: italic;
  padding: 1rem;
  text-align: center;
}

/* Cards */
.card {
  background-color: var(--white);
  border-radius: var(--rounded-md);
  box-shadow: var(--shadow-sm);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  transition: var(--transition);
  border: 1px solid var(--light-gray);
}

.card:hover {
  box-shadow: var(--shadow);
}

/* Placement and Internship Cards */
.placement-entry, .internship-card {
  background-color: var(--white);
  padding: 1.5rem;
  border-radius: var(--rounded-md);
  border-left: 4px solid var(--primary);
  transition: var(--transition);
  box-shadow: var(--shadow-sm);
  margin-bottom: 1.5rem;
}

.placement-entry:hover, .internship-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow);
}

.placement-entry strong, .internship-card strong {
  color: var(--dark);
  min-width: 120px;
  display: inline-block;
}

/* Document Cards */
.doc-card {
  background: var(--white);
  padding: 1.25rem;
  border-radius: var(--rounded-md);
  box-shadow: var(--shadow-sm);
  transition: var(--transition);
  border: 1px solid var(--light-gray);
  margin-bottom: 1rem;
}

.doc-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow);
}

.doc-card strong {
  font-size: 1rem;
  display: block;
  margin-bottom: 0.5rem;
  color: var(--dark);
}

/* Utility Classes */
.text-center { text-align: center; }
.mb-1 { margin-bottom: 0.5rem; }
.mb-2 { margin-bottom: 1rem; }
.mb-3 { margin-bottom: 1.5rem; }
.mb-4 { margin-bottom: 2rem; }
.p-2 { padding: 1rem; }
.p-3 { padding: 1.5rem; }

/* Responsive Design */
@media (max-width: 992px) {
  .profile-container {
    padding: 1.5rem;
  }
  
  .nav-links {
    gap: 1rem;
  }
}

@media (max-width: 768px) {
  .navbar {
    padding: 1rem;
  }
  
  .nav-links {
    display: none;
  }
  
  .mobile-menu {
    display: block;
  }
  
  .info-group {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .info-label {
    width: auto;
    margin-bottom: 0.25rem;
  }
  
  .circular-img {
    width: 150px;
    height: 150px;
  }
  
  .placement-entry, .internship-card {
    padding: 1rem;
  }
  
  .placement-entry strong, .internship-card strong {
    min-width: 100px;
  }
}

@media (max-width: 576px) {
  body {
    padding-top: 60px;
  }
  
  .profile-container {
    padding: 1rem;
    margin: 1rem;
  }
  
  .section {
    padding: 1rem;
  }
  
  .form-item {
    flex-direction: column;
    align-items: flex-start;
  }
  
  button, .btn {
    width: 100%;
    margin-bottom: 0.5rem;
  }
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.profile-container {
  animation: fadeIn 0.5s ease-out;
}

.section {
  animation: fadeIn 0.6s ease-out;
}

/* Loading States */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(67, 97, 238, 0.3);
  border-radius: 50%;
  border-top-color: var(--primary);
  animation: spin 1s ease-in-out infinite;
  margin-right: 0.5rem;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-text {
  color: var(--gray);
  font-style: italic;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
}

/* File Links */
.file-link {
  color: var(--primary);
  text-decoration: none;
  font-weight: 500;
  border-bottom: 1px dashed var(--primary);
  transition: var(--transition);
}

.file-link:hover {
  color: var(--primary-dark);
  border-bottom-style: solid;
  text-decoration: none;
}

/* Input Fields */
input[type="text"],
input[type="number"],
input[type="date"],
input[type="email"],
input[type="password"],
select,
textarea {
  width: 100%;
  padding: 0.625rem 0.875rem;
  font-size: 1rem;
  border-radius: var(--rounded-sm);
  border: 1px solid var(--light-gray);
  transition: var(--transition);
  margin-bottom: 0.5rem;
}

input[type="text"]:focus,
input[type="number"]:focus,
input[type="date"]:focus,
input[type="email"]:focus,
input[type="password"]:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

/* Custom checkbox */
input[type="checkbox"] {
  width: auto;
  margin-right: 0.5rem;
}

/* Document List */
#docList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin: 2rem 0;
}

/* Achievements List */
#achievementList {
  list-style-type: none;
  padding-left: 0;
  margin: 0;
}

#achievementList li {
  background-color: var(--light);
  padding: 1rem 1.5rem;
  margin-bottom: 0.75rem;
  border-radius: var(--rounded-sm);
  box-shadow: var(--shadow-sm);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 1rem;
}

#achievementList li a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 600;
  word-break: break-word;
  max-width: 100%;
}

/* Payment Receipts */
.receipt {
  margin-top: 1rem;
  padding: 1rem;
  border-left: 4px solid var(--primary);
  background: var(--white);
  box-shadow: var(--shadow-sm);
  border-radius: var(--rounded-sm);
  margin-bottom: 1rem;
}

.receipt p {
  margin: 0.5rem 0;
}

.year-section {
  margin-bottom: 2rem;
  border: 1px solid var(--light-gray);
  padding: 1.5rem;
  border-radius: var(--rounded-md);
  background: var(--white);
  box-shadow: var(--shadow-sm);
}

.year-section h3 {
  margin-top: 0;
  color: var(--primary);
  border-bottom: 2px solid var(--light-gray);
  padding-bottom: 0.5rem;
  margin-bottom: 1rem;
}

/* Status Indicators */
.status-pending {
  color: var(--warning);
  font-weight: 500;
}

.status-approved {
  color: var(--success);
  font-weight: 500;
}

.status-rejected {
  color: var(--danger);
  font-weight: 500;
}

/* Badges */
.badge {
  display: inline-block;
  padding: 0.25rem 0.5rem;
  border-radius: 1rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.badge-primary {
  background-color: rgba(67, 97, 238, 0.1);
  color: var(--primary);
}

.badge-success {
  background-color: rgba(74, 222, 128, 0.1);
  color: var(--success);
}

.badge-danger {
  background-color: rgba(248, 113, 113, 0.1);
  color: var(--danger);
}

/* Tooltip */
.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltip-text {
  visibility: hidden;
  width: 120px;
  background-color: var(--dark);
  color: var(--white);
  text-align: center;
  border-radius: var(--rounded-sm);
  padding: 0.5rem;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -60px;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}
/* ----- */
/* For Scholarship Forms */
.form-item button {
  padding: 5px 10px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.form-item button:first-of-type { /* Edit button */
  background-color: #4CAF50; /* Green */
  color: white;
}

.form-item button:last-of-type { /* Delete button */
  background-color: #f44336; /* Red */
  color: white;
  margin-left: 10px;
}

/* For Internship Cards */
.internship-card p {
  margin: 8px 0;
  display: flex;
  align-items: center;
}

.internship-card p strong {
  min-width: 80px;
  display: inline-block;
}

.internship-card .edit-field {
  margin-left: 10px;
  flex-grow: 1;
}

/* Buttons in one line */
.internship-card .button-group {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.internship-card .edit-btn {
  background-color: #4CAF50;
  color: white;
}


.internship-card .delete-btn {
  background-color: #f44336;
  color: white;
}
/* Add this to your existing styles */
#editBtn, #doneBtn, .edit-btn, .form-item button:first-of-type {
  background-color: #90EE90; /* Light Green */
  color: var(--dark); /* Dark text for contrast */
  border: 1px solid rgba(0,0,0,0.1); /* Subtle border */
}

/* Hover states */
#editBtn:hover, #doneBtn:hover, .edit-btn:hover, .form-item button:first-of-type:hover {
  background-color: #76D7C4; /* Slightly darker light green */
  color: var(--dark);
}

/* Done button should be slightly different */
.done-btn {
  background-color: var(--success) !important; /* Keep original green */
  color: var(--white) !important;
}

/* Delete buttons remain unchanged */
.delete-btn, #deleteBtn, .form-item button:last-of-type {
  background-color: var(--danger);
  color: var(--white);
}
:root {
  --light-green: #90EE90;
  --light-green-dark: #76D7C4;
}

.edit-btn {
  background-color: var(--light-green);
}

/* Consolidated Button Styling */
#editBtn, #doneBtn, .edit-btn, .form-item button:first-of-type {
  background-color: #90EE90; /* Light Green */
  color: var(--dark);
  border: 1px solid rgba(0,0,0,0.1);
  transition: var(--transition);
}

/* Hover states */
#editBtn:hover, #doneBtn:hover, .edit-btn:hover, .form-item button:first-of-type:hover {
  background-color: #76D7C4;
  color: var(--dark);
}

/* Done button (special case) */
.done-btn {
  background-color: var(--success) !important;
  color: var(--white) !important;
}

/* Delete buttons */
.delete-btn, #deleteBtn, .form-item button:last-of-type {
  background-color: var(--danger);
  color: var(--white);
}

/* Payment Section Styles */
#paymentContainer {
  margin-top: 1.5rem;
}

#paymentContainer select {
  padding: 0.5rem 1rem;
  border-radius: var(--rounded-sm);
  border: 1px solid var(--light-gray);
  margin-bottom: 1.5rem;
  font-size: 1rem;
  background-color: var(--white);
  transition: var(--transition);
}

#paymentContainer select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

.year-section {
  background-color: var(--white);
  border-radius: var(--rounded-md);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--light-gray);
}

.year-section h3 {
  color: var(--primary);
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--light-gray);
}

.receipt {
  background-color: var(--light);
  padding: 1rem;
  border-radius: var(--rounded-sm);
  margin-bottom: 1rem;
  border-left: 4px solid var(--primary);
  transition: var(--transition);
}

.receipt:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}

.receipt strong {
  display: block;
  margin-bottom: 0.5rem;
  color: var(--dark);
}

.receipt a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 500;
  display: inline-block;
  margin-bottom: 1rem;
  border-bottom: 1px dashed var(--primary);
  transition: var(--transition);
}

.receipt a:hover {
  color: var(--primary-dark);
  border-bottom-style: solid;
}

.receipt input[type="file"] {
  margin: 0.5rem 0 1rem;
}

/* Payment Buttons */
.receipt button {
  padding: 0.5rem 1rem;
  border-radius: var(--rounded-sm);
  font-weight: 500;
  font-size: 0.875rem;
  cursor: pointer;
  transition: var(--transition);
  border: none;
  margin-right: 0.5rem;
  margin-top: 0.5rem;
}

.receipt button.edit-btn {
  background-color: #90EE90; /* Light green */
  color: var(--dark);
}

.receipt button.edit-btn:hover {
  background-color: #76D7C4; /* Slightly darker light green */
  transform: translateY(-2px);
}

.receipt button.done-btn {
  background-color: var(--success);
  color: var(--white);
}

.receipt button.done-btn:hover {
  background-color: #22c55e;
  transform: translateY(-2px);
}

.receipt button.delete-btn {
  background-color: var(--danger);
  color: var(--white);
}

.receipt button.delete-btn:hover {
  background-color: #ef4444;
  transform: translateY(-2px);
}

/* Labeled Inputs */
.receipt label {
  display: inline-block;
  min-width: 100px;
  color: var(--dark);
  font-weight: 500;
  margin-right: 0.5rem;
}

.receipt input[type="number"] {
  padding: 0.375rem 0.75rem;
  border-radius: var(--rounded-sm);
  border: 1px solid var(--light-gray);
  width: 120px;
  margin-bottom: 0.5rem;
}

.receipt input[type="number"]:disabled {
  background-color: var(--light-gray);
}

/* Payment Section Styling */
#paymentContainer {
  margin: 2rem 0;
}

/* Year Selector Styling */
#paymentContainer select {
  padding: 0.75rem 1.25rem;
  border-radius: var(--rounded-sm);
  border: 1px solid var(--light-gray);
  background-color: var(--white);
  font-size: 1rem;
  color: var(--dark);
  margin-bottom: 1.5rem;
  width: 100%;
  max-width: 300px;
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236c757d'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 1rem;
  transition: var(--transition);
}

#paymentContainer select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

/* Receipt Card Styling */
.receipt {
  background: var(--white);
  border-radius: var(--rounded-md);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow-sm);
  border-left: 4px solid var(--primary);
  transition: var(--transition);
}

.receipt:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow);
}

.receipt strong {
  display: block;
  margin-bottom: 1rem;
  color: var(--dark);
  font-size: 1.1rem;
}

.receipt a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 500;
  display: inline-block;
  margin-bottom: 1rem;
  padding: 0.5rem 0;
  border-bottom: 1px dashed var(--primary);
  transition: var(--transition);
}

.receipt a:hover {
  color: var(--primary-dark);
  border-bottom-style: solid;
}

/* Button Styling */
.receipt button {
  padding: 0.625rem 1.25rem;
  border-radius: var(--rounded-sm);
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  border: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  margin-right: 0.75rem;
  margin-top: 0.75rem;
}

.receipt button.edit-btn {
  background-color: var(--success);
  color: var(--white);
}

.receipt button.edit-btn:hover {
  background-color: #22c55e;
  transform: translateY(-2px);
}

.receipt button.done-btn {
  background-color: var(--primary);
  color: var(--white);
}

.receipt button.done-btn:hover {
  background-color: var(--primary-dark);
}

.receipt button.delete-btn {
  background-color: var(--danger);
  color: var(--white);
}

.receipt button.delete-btn:hover {
  background-color: #ef4444;
  transform: translateY(-2px);
}

/* Input Styling */
.receipt input[type="number"] {
  padding: 0.5rem 0.75rem;
  border-radius: var(--rounded-sm);
  border: 1px solid var(--light-gray);
  width: 120px;
  margin-right: 1rem;
  margin-bottom: 0.5rem;
}

.receipt input[type="number"]:disabled {
  background-color: var(--light-gray);
}

.receipt input[type="file"] {
  margin: 0.5rem 0 1rem;
  width: 100%;
  max-width: 300px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .receipt button {
    width: 100%;
    margin-right: 0;
    margin-bottom: 0.5rem;
  }
  
  .receipt input[type="number"] {
    width: 100%;
    margin-right: 0;
  }
}


  /* Edit Button (Green) */
  .receipt button:first-of-type {
    background-color: #38a169;
    color: white;
  }

  /* Done Button (Blue) */
  .receipt button:nth-of-type(2) {
    background-color: #3182ce;
    color: white;
  }

  /* Delete Button (Red) */
  .receipt button:last-of-type {
    background-color: #e53e3e;
    color: white;
  }

  /* Label Styles */
  .receipt label {
    display: inline-block;
    width: 120px;
    font-weight: 500;
    color: #4a5568;
    margin-right: 10px;
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    #paymentContainer {
      padding: 15px;
    }
    
    .receipt {
      padding: 12px !important;
    }
    
    .receipt label {
      width: 100px;
    }
  }


</style>
</head>
<body>

  <nav class="navbar">
    <div class="logo">
      <i class="fas fa-graduation-cap"></i> StudentSys
    </div>
    <ul class="nav-links">
      <li><a href="SHome.html"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="SHome.html#about"><i class="fas fa-info-circle"></i> About Us</a></li>
      <li><a href="SHome.html#features"><i class="fas fa-star"></i> Features</a></li>
      <li><a href="SHome.html#contact"><i class="fas fa-envelope"></i> Contact Us</a></li>
      <li><a href="student-dashboard.html" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>

      <li><a href="login_signup.html">Logout</a></li>
    </ul>
    <div class="mobile-menu">
      <i class="fas fa-bars"></i>
    </div>
  </nav>

  <div class="profile-container">
    <h1>Student Profile</h1>
   <p class="email-info" id="emailDisplay" style="display: none;">Loading email...</p>

   <div class="container">
    <div style="text-align:center">
      <!-- <img id="profileImage" src="" alt="Profile Image" class="profile-photo"> -->
       <img id="profileImage" src="https://via.placeholder.com/150" alt="Profile Image" class="circular-img" />

    </div>
    <div class="section">
 


  <div class="info-group"><span class="info-label">Name:</span> <span id="name" data-key="name"></span></div>
  <div class="info-group"><span class="info-label">PRN:</span> <span id="prn" data-key="prn"></span></div>
  <div class="info-group"><span class="info-label">ABC ID:</span> <span id="abcId" data-key="abcId"></span></div>
  <div class="info-group"><span class="info-label">Class Name:</span> <span id="className" data-key="className"></span></div>

  <div class="info-group"><span class="info-label">Roll No:</span> <span id="rollNo" data-key="rollNo"></span></div>
  <div class="info-group"><span class="info-label">DOB:</span> <span id="dob" data-key="dob"></span></div>
  <div class="info-group"><span class="info-label">Branch:</span> <span id="branch" data-key="branch"></span></div>
  <div class="info-group"><span class="info-label">Gender:</span> <span id="gender" data-key="gender"></span></div>
  <div class="info-group"><span class="info-label">Phone:</span> <span id="phone" data-key="phone"></span></div>
  <div class="info-group"><span class="info-label">Email:</span> <span id="email" data-key="email"></span></div>
  <div class="info-group"><span class="info-label">Admission Year:</span> <span id="admissionYear" data-key="admissionYear"></span></div>
  <div class="info-group"><span class="info-label">Admission Mode:</span> <span id="admissionMode" data-key="admissionMode"></span></div>
  <div class="info-group"><span class="info-label">Caste Category:</span> <span id="casteCategory" data-key="casteCategory"></span></div>
  <div class="info-group"><span class="info-label">Sub-Caste:</span> <span id="subCaste" data-key="subCaste"></span></div>
  
   <button id="editBtn">Edit</button>
<button id="doneBtn" style="display:none;">Done</button>
<button id="deleteBtn" style="background-color: red; color: white;">Delete</button>
</div>

   
  </div>

   <h2>Student Academic Marksheet</h2>
   <div id="profileContainer"></div>
  
    
   <h2>Uploaded Documents</h2>
   <div id="docList"></div>
   
    <h2>Fee Payment Details</h2>
    <div id="paymentContainer"></div>

     <h2>Uploaded Scholarship Forms</h2>
<input type="file" id="editFileInput" style="display: none;" accept="application/pdf" />
<ul class="form-list" id="formList">
  <li class="no-data"></li>
</ul>

    <h2>Placement Details</h2>
    <div id="placements">
      <p class="no-data"></p>
    </div>

     <h2>Internship Details</h2>
     <div id="internshipsContainer"></div>

      <h2>Achievements certificate</h2>
      <ul id="achievementList"></ul>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // const studentEmail = localStorage.getItem('studentEmail');
const studentEmail = localStorage.getItem('studentEmail');
      const emailDisplay = document.getElementById('emailDisplay');
      const formList = document.getElementById('formList');
      const placementsContainer = document.getElementById('placements');
      const internshipsContainer = document.getElementById("internshipsContainer");

      if (!studentEmail) {
        emailDisplay.textContent = "You are not logged in.";
        formList.innerHTML = '<li class="no-data">Please log in to view your scholarship forms.</li>';
        placementsContainer.innerHTML = '<p class="no-data">Please log in to view your placement data.</p>';
         internshipsContainer.innerHTML = '<p class="no-data">Please log in to view your internship data.</p>';
      return;
        return;
      }

      emailDisplay.textContent = "Email: " + studentEmail;
      
///////////////////////////////////////gernal information//////////////////////////////////////////      

 
  if (!studentEmail) {
    alert("User not logged in");
    window.location.href = "login_signup.html";
  } else {
    fetch(`http://localhost:3000/api/student/email/${email}`)
      .then(res => res.json())
      .then(data => {
        document.getElementById("profileImage").src = data.profileImage || "https://via.placeholder.com/150";
        document.getElementById("name").textContent = data.name;
        document.getElementById("prn").textContent = data.prn;
        document.getElementById("abcId").textContent = data.abcId;
        document.getElementById("rollNo").textContent = data.rollNo;
        document.getElementById("className").textContent = data.className;

        document.getElementById("dob").textContent = new Date(data.dob).toISOString().split("T")[0];
        document.getElementById("branch").textContent = data.branch;
        document.getElementById("gender").textContent = data.gender;
        document.getElementById("phone").textContent = data.phone;
        document.getElementById("email").textContent = data.email;
        document.getElementById("admissionYear").textContent = data.admissionYear;
        document.getElementById("admissionMode").textContent = data.admissionMode;
        document.getElementById("casteCategory").textContent = data.casteCategory;
        document.getElementById("subCaste").textContent = data.subCaste;
      })
      .catch(err => {
        console.error(err);
        alert("Could not load profile");
      });
  }

  const uploadForm = document.getElementById("uploadForm");
  if (uploadForm) {
    uploadForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      //const data = Object.fromEntries(formData.entries());

      // Replace branch and admissionMode values with visible dropdown text (if available)
     const branchSelect = document.getElementById("branch");
if (branchSelect && branchSelect.options[branchSelect.selectedIndex]) {
  formData.set("branch", branchSelect.options[branchSelect.selectedIndex].text);
}

const modeSelect = document.getElementById("admissionMode");
if (modeSelect && modeSelect.options[modeSelect.selectedIndex]) {
  formData.set("admissionMode", modeSelect.options[modeSelect.selectedIndex].text);
}

      localStorage.setItem("userEmail", data.email); // store email for profile use

      
fetch("http://localhost:3000/api/student/save", {
  method: "POST",
  body: formData // Send FormData directly, don't set headers manually
})
        .then(res => {
          if (!res.ok) throw new Error("Upload failed");
          alert("Profile uploaded successfully");
          location.reload();
        })
        .catch(err => {
          console.error(err);
          alert("Error uploading profile");
        });
    });

  }

  // ----------- EDIT AND DONE FUNCTIONALITY BELOW -----------

  const fields = [
    "name", "prn", "abcId", "rollNo", "className", "dob", "branch", "gender",
    "phone", "email", "admissionYear", "admissionMode", "casteCategory", "subCaste"
  ];

  const editBtn = document.getElementById("editBtn");
  const doneBtn = document.getElementById("doneBtn");

  if (editBtn && doneBtn) {
    editBtn.addEventListener("click", () => {
      fields.forEach(id => {
        const span = document.getElementById(id);
        if (span) {
          const input = document.createElement("input");
          input.type = id === "dob" ? "date" : "text";
          input.value = span.textContent;
          input.id = id;
          span.replaceWith(input);
        }
      });
      //CHANGE
       const imageElement = document.getElementById("profileImage");
  if (imageElement) {
    const fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.id = "profileImageInput";
     fileInput.name = "profileImage"; // ✅ This ensures the backend receives it
    fileInput.accept = "image/*";

    

    imageElement.insertAdjacentElement("afterend", fileInput);
  }
      editBtn.style.display = "none";
      doneBtn.style.display = "inline-block";
    });


    
    doneBtn.addEventListener("click", () => {
      const updatedData = { email };

      fields.forEach(id => {
        const input = document.getElementById(id);
        if (input && input.tagName === "INPUT") {
          updatedData[id] = input.value;
        }
      });
      fetch("http://localhost:3000/api/student/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedData)
      })  
        .then(res => {
          if (!res.ok) throw new Error("Update failed");
          alert("Profile updated successfully");
          location.reload();
        })
        .catch(err => {
          console.error(err);
          alert("Failed to update profile");
        });
    });




  }

  //DELETE BUTTON 
  const deleteBtn = document.getElementById("deleteBtn");

if (deleteBtn) {
  deleteBtn.addEventListener("click", () => {
    if (confirm("Are you sure you want to delete your profile? This cannot be undone.")) {
      fetch(`http://localhost:3000/api/student/delete/${email}`, {
        method: "DELETE"
      })
        .then(res => {
          if (!res.ok) throw new Error("Delete failed");
          alert("Profile deleted successfully");
          localStorage.removeItem("userEmail");
          window.location.href = ""; // Redirect after deletion
        })
        .catch(err => {
          console.error(err);
          alert("Failed to delete profile");
        });
    }
  });
}

////////////////// Load scholarship forms///////////////////////////////////////////////////
     try {
  const res = await fetch(`/api/scholarship/${encodeURIComponent(studentEmail)}`);
  const forms = await res.json();

  const formList = document.getElementById('formList');
  formList.innerHTML = '';

  if (forms.length === 0) {
    formList.innerHTML = '<li class="no-data">No scholarship forms uploaded yet.</li>';
  } else {
    forms.forEach(form => {
      const li = document.createElement('li');
      li.className = 'form-item';

      const a = document.createElement('a');
      a.href = form.cloudinaryUrl;
      a.target = '_blank';
      a.textContent = form.originalName || 'View Form';

      const span = document.createElement('span');
      span.textContent = 'Uploaded at: ' + new Date(form.uploadedAt).toLocaleString();

      const btn = document.createElement('button');
      btn.textContent = 'Edit';
      //change
      // Delete Button
const deleteBtn = document.createElement('button');
deleteBtn.textContent = 'Delete';
deleteBtn.style.marginLeft = '10px';
deleteBtn.onclick = async () => {
  if (!confirm('Are you sure you want to delete this form?')) return;

  try {
    const delRes = await fetch(`/api/scholarship/delete/${form._id}`, {
      method: 'DELETE',
    });
    const result = await delRes.json();

    if (delRes.ok) {
      alert('Form deleted successfully');
      li.remove(); // remove the deleted form from the list immediately
    } else {
      alert('Error deleting form: ' + result.error);
    }
  } catch (err) {
    console.error('❌ Error deleting form:', err);
    alert('Failed to delete the form');
  }
};
li.appendChild(deleteBtn);



      btn.onclick = () => {
        const fileInput = document.getElementById('editFileInput');
        fileInput.click();

        fileInput.onchange = async () => {
          const file = fileInput.files[0];
          if (!file) return;

          const formData = new FormData();
          formData.append('scholarshipUpload', file);
          formData.append('formId', form._id);

          try {
            const updateRes = await fetch('/api/scholarship/edit', {
              method: 'PUT',
              body: formData
            });

            const result = await updateRes.json();
            if (updateRes.ok) {
              alert('Form updated successfully');
              location.reload();
            } else {
              alert('Error updating form: ' + result.error);
            }
          } catch (err) {
            console.error('Error editing form:', err);
            alert('Failed to edit the form');
          }
        };
      };

      li.appendChild(a);
      li.appendChild(span);
      li.appendChild(btn);
      li.appendChild(deleteBtn);//change
      formList.appendChild(li);
    });
  }
} catch (err) {
  console.error("❌ Failed to fetch scholarship data:", err);
  const formList = document.getElementById('formList');
  formList.innerHTML = '<li class="no-data">Error loading scholarship data.</li>';
}

      
////////////////////// Load placement data////////////////////////////////////////////////////////
      try {
        const res = await fetch(`/api/placement/${encodeURIComponent(studentEmail)}`);
        const placements = await res.json();

        placementsContainer.innerHTML = '';
        if (!placements.length) {
          placementsContainer.innerHTML = '<p class="no-data">No placement records found.</p>';
          return;
        }

        placements.forEach((placement, i) => {
          const div = document.createElement('div');
          div.className = 'placement-entry';
          div.dataset.id = placement._id;

     
      div.innerHTML = `
  <h4>Placement ${i + 1}</h4>
  <p><strong>Company:</strong> <span class="text" data-key="companyName">${placement.companyName}</span></p>
  <p><strong>Role:</strong> <span class="text" data-key="jobRole">${placement.jobRole}</span></p>
  <p><strong>Date:</strong> <span class="text" data-key="placementDate">${new Date(placement.placementDate).toISOString().split("T")[0]}</span></p>
  <p><strong>Status:</strong> <span class="text" data-key="status">${placement.status}</span></p>
  <p><strong>Package:</strong> <span class="text" data-key="package">${placement.package}</span></p>

  <p><strong>Offer Letter:</strong> 
    ${placement.offerLetter?.url ? `<a href="${placement.offerLetter.url}" target="_blank">${placement.offerLetter.originalname || 'View'}</a>` : 'Not uploaded'}
    <input type="file" name="offerLetter" style="display:none;" />
    <span class="file-note" style="display:none; font-size: 0.9em; color: gray;">Select a new file to replace</span>
  </p>

  <p><strong>Joining Letter:</strong> 
    ${placement.joiningLetter?.url ? `<a href="${placement.joiningLetter.url}" target="_blank">${placement.joiningLetter.originalname || 'View'}</a>` : 'Not uploaded'}
    <input type="file" name="joiningLetter" style="display:none;" />
    <span class="file-note" style="display:none; font-size: 0.9em; color: gray;">Select a new file to replace</span>
  </p>

  <button class="edit-btn">Edit</button>
  <button class="done-btn" style="display:none;">Done</button>
  <button class="delete-btn" style="background-color: red; color: white;">Delete</button>
`;

          placementsContainer.appendChild(div);




          div.querySelector('.delete-btn').addEventListener('click', async function () {
  const parent = this.parentElement;
  const id = parent.dataset.id;

  if (!confirm("Are you sure you want to delete this placement?")) return;

  try {
    const res = await fetch('/api/placement/delete', {
      method: "DELETE",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id })
    });

    if (!res.ok) throw new Error("Delete failed");
    alert("Placement deleted");

    parent.remove(); // Remove from DOM immediately
  } catch (err) {
    console.error(err);
    alert("Failed to delete placement");
  }
});

        });

      document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const parent = this.parentElement;
        parent.querySelectorAll('.text').forEach(span => {
          const input = document.createElement("input");
          input.type = span.dataset.key === "placementDate" ? "date" : "text";
          input.value = span.textContent;
          input.setAttribute("data-key", span.dataset.key);
          span.replaceWith(input);
        });
   
              parent.querySelectorAll('input[type="file"]').forEach(f => {
          f.style.display = 'inline';
          const note = f.nextElementSibling;
          if (note && note.classList.contains('file-note')) {
            note.style.display = 'inline';
          }
        });

            this.style.display = "none";
            parent.querySelector(".done-btn").style.display = "inline";
          });
        });

        document.querySelectorAll('.done-btn').forEach(btn => {
          btn.addEventListener('click', async function () {
            const parent = this.parentElement;
            const id = parent.dataset.id;
            const formData = new FormData();

        parent.querySelectorAll('input[data-key]').forEach(input => {
          formData.append(input.dataset.key, input.value);
        });

        parent.querySelectorAll('input[type="file"]').forEach(fileInput => {
          if (fileInput.files.length > 0) {
            formData.append(fileInput.name, fileInput.files[0]);
          }
        });

        formData.append("placementId", id);

        try {
          const res = await fetch('/api/placement/update', {
            method: "POST",
            body: formData
          });

          if (!res.ok) throw new Error("Update failed");

          alert("Placement updated successfully");

        // Refresh the specific placement entry
        const updated = await res.json();
        parent.querySelectorAll('input[data-key]').forEach(input => {
          const span = document.createElement('span');
          span.className = 'text';
          span.setAttribute('data-key', input.dataset.key);
          span.textContent = input.value;
          input.replaceWith(span);
        });

          // Update file links if new ones were uploaded
          if (updated.offerLetter) {
            const offerEl = parent.querySelector('a[href*="offerLetter"]');
            if (offerEl) {
              offerEl.href = updated.offerLetter.url;
              offerEl.textContent = updated.offerLetter.originalName || 'View';
            }
          }

          if (updated.joiningLetter) {
            const joinEl = parent.querySelector('a[href*="joiningLetter"]');
            if (joinEl) {
              joinEl.href = updated.joiningLetter.url;
              joinEl.textContent = updated.joiningLetter.originalName || 'View';
            }
          }

          // Hide file inputs and "Done", show "Edit"
          parent.querySelectorAll('input[type="file"]').forEach(f => f.style.display = 'none');
          parent.querySelectorAll('.file-note').forEach(note => note.style.display = 'none');
          this.style.display = 'none';
          parent.querySelector('.edit-btn').style.display = 'inline';

                  } catch (err) {
                    console.error(err);
                    alert("Failed to update placement");
                  }
                });
              });

            } catch (err) {
              console.error("❌ Failed to fetch placement data:", err);
              placementsContainer.innerHTML = '<p class="no-data">Error loading placement data.</p>';
            }
          });

//////////////load intership//////////////////////////////////////////////////////////////////////////////////////

    const studentEmail = localStorage.getItem("studentEmail");
    if (!studentEmail) {
      document.getElementById("internshipsContainer").innerText = "No email found in localStorage.";
    } else {
      fetch(`/api/internship/${studentEmail}`)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("internshipsContainer");
          container.innerHTML = "";
          if (data.length === 0) {
            container.innerHTML = "<p>No internship data available.</p>";
            return;
          }

         data.forEach((item, index) => {
          const div = document.createElement("div");
          div.className = "internship-card";

          
      
div.innerHTML = ` 
  <input type="hidden" class="internship-id" value="${item._id}" />
  <p><strong>Company:</strong> <input class="edit-field" name="companyName" value="${item.companyName}" disabled></p>
  <p><strong>Role:</strong> <input class="edit-field" name="jobRole" value="${item.jobRole}" disabled></p>
  <p><strong>Date:</strong> <input class="edit-field" type="date" name="internshipDate" value="${item.internshipDate?.substring(0,10)}" disabled></p>
  <p><strong>Status:</strong> <input class="edit-field" name="status" value="${item.status}" disabled></p>
  <p><strong>Duration:</strong> <input class="edit-field" name="duration" value="${item.duration}" disabled></p>

  <p>
    <a href="${item.offerLetter?.url}" target="_blank">Offer Letter</a>
    <input type="file" name="offerLetter" class="edit-file" style="display:none" />
  </p>
  <p>
    <a href="${item.certificate?.url}" target="_blank">Certificate</a>
    <input type="file" name="certificate" class="edit-file" style="display:none" />
  </p>
  <p>
    <a href="${item.joiningLetter?.url}" target="_blank">Joining Letter</a>
    <input type="file" name="joiningLetter" class="edit-file" style="display:none" />
  </p>

  <div class="button-group">
    <button class="edit-btn">Edit</button>
    <button class="internship-done-btn" style="display:none;">Done</button>
    <button class="intern-delete-btn" data-type="internship" data-id="${item._id}">Delete</button>

  </div>
`;



          container.appendChild(div);
        });

        container.addEventListener("click", async (e) => { 
  const card = e.target.closest(".internship-card");
  if (!card) return;

  if (e.target.classList.contains("edit-btn")) {
    card.querySelectorAll(".edit-field").forEach(input => input.disabled = false);
    card.querySelectorAll(".edit-file").forEach(input => input.style.display = "inline");
    card.querySelector(".edit-btn").style.display = "none";
    card.querySelector(".internship-done-btn").style.display = "inline";

  }

 if (e.target.classList.contains("internship-done-btn")) {
    const id = card.querySelector(".internship-id").value;
    const formData = new FormData();
    formData.append("id", id);

    card.querySelectorAll(".edit-field").forEach(input => {
      formData.append(input.name, input.value);
    });

    card.querySelectorAll(".edit-file").forEach(fileInput => {
      if (fileInput.files[0]) {
        formData.append(fileInput.name, fileInput.files[0]);
      }
    });

    try {
      const response = await fetch("/api/internship/update", {
        method: "PUT",
        body: formData
      });
      const result = await response.json();
      console.log("🔁 Internship update response:", result);  // ✅ NEW: Debug line

      if (response.ok) {
        alert("Internship updated successfully!");
        location.reload();
      } 
      else if (response.status === 404 && result.message === "Internship entry not found") {
  // ✅ No alert here → hides "Error updating document..." for valid 404
  console.warn("Internship not found. Ignored.");
}
//       else if (!response.ok && result.message !== "Internship entry not found") {
//   alert("Update failed: " + result.message);
// }

else {
  // ✅ Replaces noisy alerts with safe console log
  console.warn("Update failed:", result.message);
}


    } catch (err) {
      console.error("❌ Update error:", err);
      alert("An error occurred while updating.");
    }
  }

  // ✅ ADD DELETE LOGIC HERE
  // if (e.target.classList.contains("delete-btn")) {
  if (e.target.classList.contains("intern-delete-btn") && e.target.dataset.type === "internship") {

    const id = card.querySelector(".internship-id").value;

    if (confirm("Are you sure you want to delete this internship entry?")) {
      try {
        const res = await fetch(`/api/internship/${id}`, {
          method: "DELETE"
        });

        const result = await res.json();

        if (res.ok) {
          alert("Internship deleted successfully.");
          card.remove(); // Instantly removes from UI
        } else {
          alert("Delete failed: " + result.message);
        }
      } catch (err) {
        console.error("❌ Deletion error:", err);
        alert("An error occurred while deleting.");
      }
    }
  }
});

      })
      .catch(err => {
        document.getElementById("internshipsContainer").innerText = "Failed to load internship data.";
        console.error(err);
      });
    }

/////////////////////////////achievement/////////////////////////////////////////////////////////////////////////////////////////
                fetch(`/api/certificates/student/${studentEmail}`)
  .then(res => res.json())
  .then(data => {
    const list = document.getElementById('achievementList');
    if (!data.certificates || data.certificates.length === 0) {
      list.innerHTML = '<li>No certificates uploaded.</li>';
      return;
    }

    data.certificates.forEach(cert => {
      const li = document.createElement('li');
      li.innerHTML = `
        <strong>${cert.name}</strong><br/>
        <a href="${cert.filePath}" target="_blank">${cert.fileName}</a>
        <button class="edit-btn" data-id="${cert._id}">Edit</button>
        <button class="delete-btn" data-id="${cert._id}">Delete</button>

        <!-- 🔽 Hidden Edit Form for this certificate -->
    <div class="edit-cert-form" id="edit-form-${cert._id}" style="display: none; margin-top: 10px; padding: 10px; border: 1px solid #ccc;">
      <input type="hidden" value="${cert._id}" class="edit-cert-id">
      <label>
        Certificate Name:
        <input type="text" value="${cert.name}" class="edit-cert-name">
      </label>
      <br><br>
      <label>
        Upload new certificate (PDF):
        <input type="file" class="edit-cert-file" accept="application/pdf,image/*">
      </label>
      <br><br>
      <button class="save-edit-cert">Save</button>
      <button class="cancel-edit-cert">Cancel</button>
    </div>
      `;
      list.appendChild(li);
    });

   
document.querySelectorAll('.edit-btn').forEach(button => {
  button.addEventListener('click', () => {
    const certId = button.getAttribute('data-id');
    document.querySelector(`#edit-form-${certId}`).style.display = 'block';
  });
});

document.querySelectorAll('.cancel-edit-cert').forEach(button => {
  button.addEventListener('click', () => {
    const form = button.closest('.edit-cert-form');
    form.style.display = 'none';
  });
});

// document.querySelectorAll('.save-edit-cert').forEach(button => {
//   button.addEventListener('click', async () => {
//     const form = button.closest('.edit-cert-form');

//     if (!form) return; // ✅ DOM element removed — skip

//     const certId = form.querySelector('.edit-cert-id').value;
//     const newName = form.querySelector('.edit-cert-name').value;
//     const fileInput = form.querySelector('.edit-cert-file');
//     const file = fileInput.files[0];

//     const formData = new FormData();
//     formData.append('certificateId', certId);
//     formData.append('newName', newName);
//     if (file) {
//       formData.append('certificate', file);
//     }

//     try {
//       const response = await fetch('/api/certificates/edit', {
//         method: 'PUT',
//         body: formData
//       });
//       const result = await response.json();
//       if (response.ok) {
//         alert('Certificate updated successfully.');
//         location.reload();
//       } else {
//         alert('Update failed: ' + result.message);
//       }
//     } catch (err) {
//       console.error(err);
//       alert('Error updating certificate.');
//     }
//   });
// });

document.querySelectorAll('.save-edit-cert').forEach(button => {
  button.addEventListener('click', async () => {
    const form = button.closest('.edit-cert-form');
    if (!form) return; // ✅ DOM element removed — skip

    const certIdInput = form.querySelector('.edit-cert-id');
    const nameInput = form.querySelector('.edit-cert-name');
    const fileInput = form.querySelector('.edit-cert-file');

    // ✅ Defensive check for missing elements (possibly deleted from DOM)
    if (!certIdInput || !nameInput || !fileInput) {
      alert("Missing required fields for update.");
      return;
    }

    const certId = certIdInput.value;
    const newName = nameInput.value;
    const file = fileInput.files[0];

    const formData = new FormData();
    formData.append('certificateId', certId);
    formData.append('newName', newName);
    if (file) {
      formData.append('certificate', file);
    }

    try {
      const response = await fetch('/api/certificates/edit', {
        method: 'PUT',
        body: formData
      });
      const result = await response.json();
      if (response.ok) {
        alert('Certificate updated successfully.');
        location.reload();
      } else {
        alert('Update failed: ' + result.message);
      }
    } catch (err) {
      console.error(err);
      alert('Error updating certificate.');
    }
  });
});




    // ✅ Delete handler (NEW)
    document.querySelectorAll('.delete-btn').forEach(button => {
      button.addEventListener('click', async () => {
        const certId = button.getAttribute('data-id');
        if (confirm('Are you sure you want to delete this certificate?')) {
          try {
            const response = await fetch(`/api/certificates/${certId}`, {
              method: 'DELETE'
            });
            const result = await response.json();
            // if (response.ok) {
            //   alert('Certificate deleted successfully.');
            //   button.parentElement.remove(); // Remove the <li> from DOM
            // } else {
            //   alert('Error deleting certificate: ' + result.message);
            // }
            if (response.ok) {
  alert('Certificate deleted successfully.');
  button.closest('li').remove(); // ✅ safer than button.parentElement
} else {
  alert('Error deleting certificate: ' + result.message);
}

          } catch (error) {
            console.error('Delete error:', error);
            alert('An error occurred while deleting the certificate.');
          }
        }
      });
    });
  })
  .catch(err => {
    console.error('Failed to load certificates:', err);
  });

/////////////////////documents/////////////////////////////////////////////////////////////

          const email = localStorage.getItem("studentEmail");

fetch(`/api/documents/${email}`)
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById("docList");
    container.innerHTML = "";

    if (!data || data.length === 0) {
      container.innerHTML = "<p>No documents uploaded.</p>";
      return;
    }

    data.forEach(entry => {
      entry.documents.forEach(doc => {
        const div = document.createElement("div");
        div.className = "doc-card";

        const docType = doc.docType || "Document";

        div.innerHTML = `
          <span>
            <strong>${docType}</strong> : 
            <a href="${doc.cloudinaryUrl}" target="_blank" style="color:blue; text-decoration:underline;">
              ${doc.originalName || doc.docName}
            </a>
          </span>
          <button class="edit-btn" data-doc-id="${doc._id}" data-student-email="${entry.studentEmail}">Edit</button>
          <button class="delete-btn" data-doc-id="${doc._id}" data-student-email="${entry.studentEmail}">Delete</button>
        `;
        container.appendChild(div);
      });
    });

    // EDIT button logic
    document.querySelectorAll(".edit-btn").forEach(button => {
      button.addEventListener("click", () => {
        const docId = button.getAttribute("data-doc-id");
        const studentEmail = button.getAttribute("data-student-email");

        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "application/pdf,image/*";
        fileInput.style.display = "none";
        document.body.appendChild(fileInput);

        fileInput.addEventListener("change", async () => {
          const file = fileInput.files[0];
          if (!file) return;

          const formData = new FormData();
          formData.append("document", file);
          formData.append("studentEmail", studentEmail);
          formData.append("docId", docId);

          try {
            const res = await fetch("/api/documents/edit", {
              method: "PUT",
              body: formData
            });
            const result = await res.json();
            if (res.ok) {
              alert("Document updated successfully!");
              location.reload();
            } else {
              alert("Error updating document: " + result.message);
            }
          } catch (error) {
            console.error(error);
            alert("Failed to update document");
          } finally {
            document.body.removeChild(fileInput);
          }
        });

        fileInput.click();
      });
    });

    // DELETE button logic
    document.querySelectorAll(".delete-btn").forEach(button => {
      button.addEventListener("click", async () => {
        const docId = button.getAttribute("data-doc-id");
        const studentEmail = button.getAttribute("data-student-email");

        if (!confirm("Are you sure you want to delete this document?")) return;

        try {
          const res = await fetch("/api/documents/delete", {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ studentEmail, docId })
          });
          const result = await res.json();
          if (res.ok) {
            alert("Document deleted successfully!");
            location.reload();
          } else {
            alert("Error deleting document: " + result.message);
          }
        } catch (error) {
          console.error(error);
          alert("Failed to delete document");
        }
      });
    });
  })
  .catch(err => {
    document.getElementById("docList").innerText = "Error loading documents.";
    console.error(err);
  });


//////////////////////////////academicinfo Marksheet//////////////////////////////////////////////////////


  document.addEventListener("DOMContentLoaded", () => {
  const studentEmail = localStorage.getItem("studentEmail");
  if (!studentEmail || studentEmail === "undefined") {
    alert("No student email found, please log in again.");
    return;
  }

  const container = document.getElementById("profileContainer");

  fetch(`/api/result/${studentEmail}`)
    .then(res => {
      if (!res.ok) throw new Error("No result found");
      return res.json();
    })
    .then(data => {
      displayProfile(data);
    })
    .catch(err => {
      console.error(err);
      container.innerHTML = "<p>Failed to load data.</p>";
    });

  function displayProfile(data) {
    container.innerHTML = ""; // clear before rendering

    const yearSections = [
      { year: "1st Year", sgpa1: "sgpa1", sgpa2: "sgpa2", cgpa: "cgpa1", m1: "marksheet1", m2: "marksheet2" },
      { year: "2nd Year", sgpa1: "sgpa3", sgpa2: "sgpa4", cgpa: "cgpa2", m1: "marksheet3", m2: "marksheet4" },
      { year: "3rd Year", sgpa1: "sgpa5", sgpa2: "sgpa6", cgpa: "cgpa3", m1: "marksheet5", m2: "marksheet6" },
      { year: "4th Year", sgpa1: "sgpa7", sgpa2: "sgpa8", cgpa: "cgpa4", m1: "marksheet7", m2: "marksheet8" }
    ];

    yearSections.forEach(yearInfo => {
      const hasData =
        data[yearInfo.sgpa1] ||
        data[yearInfo.sgpa2] ||
        data[yearInfo.cgpa] ||
        (data.marksheets?.[yearInfo.m1]?.url) ||
        (data.marksheets?.[yearInfo.m2]?.url);

      if (!hasData) return;

      const section = document.createElement("div");
      section.className = "section";
      section.dataset.year = yearInfo.year;

      section.innerHTML = `
        <h2>${yearInfo.year}</h2>
        <div class="mark-entry"><span class="label">Semester 1 SGPA:</span> <span class="value" data-key="${yearInfo.sgpa1}">${data[yearInfo.sgpa1] || '-'}</span></div>
        <div class="mark-entry"><span class="label">Semester 1 Marksheet:</span> <span class="value">${generateFileLink(data.marksheets?.[yearInfo.m1])}</span></div>
        <div class="mark-entry"><span class="label">Semester 2 SGPA:</span> <span class="value" data-key="${yearInfo.sgpa2}">${data[yearInfo.sgpa2] || '-'}</span></div>
        <div class="mark-entry"><span class="label">Semester 2 Marksheet:</span> <span class="value">${generateFileLink(data.marksheets?.[yearInfo.m2])}</span></div>
        <div class="mark-entry"><span class="label">CGPA:</span> <span class="value" data-key="${yearInfo.cgpa}">${data[yearInfo.cgpa] || '-'}</span></div>
        <button class="edit-btn" data-year="${yearInfo.year}">Edit</button>
        <button class="delete-btn" data-year="${yearInfo.year}">Delete</button>
    
      `;

      container.appendChild(section);
    });

    // Attach edit handlers
    container.querySelectorAll(".edit-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        const year = e.target.dataset.year;
        openEditForm(year, data);
      });
    });
  
      // ✅ ADD DELETE BUTTON LOGIC
    container.querySelectorAll(".delete-btn").forEach(btn => {
      btn.addEventListener("click", async (e) => {
        const year = e.target.dataset.year;

         // ✅ Defensive Check to avoid null
    if (!year || year === "null") {
      alert("Data identifier missing. Cannot delete.");
      return;
    }
        if (!confirm(`Are you sure you want to delete data for ${year}?`)) return;

        try {


          // const res = await fetch(`/api/result/delete/${year}`, {
          //   method: "DELETE",
          //   headers: { "Content-Type": "application/json" },
          //   body: JSON.stringify({ studentEmail })
          // });


//       const keyMap = {
//   "1st Year": ["sgpa1", "sgpa2", "cgpa1", "marksheet1", "marksheet2"],
//   "2nd Year": ["sgpa3", "sgpa4", "cgpa2", "marksheet3", "marksheet4"],
//   "3rd Year": ["sgpa5", "sgpa6", "cgpa3", "marksheet5", "marksheet6"],
//   "4th Year": ["sgpa7", "sgpa8", "cgpa4", "marksheet7", "marksheet8"]
// };


// const keysToDelete = keyMap[year];
// if (!keysToDelete) {
//   alert("Unknown year mapping.");
//   return;
// }

// for (const key of keysToDelete) {
//   try {
//     let url = "";

//     // For files, delete from backend route
//     if (key.startsWith("marksheet")) {
//       url = `/api/result/delete/${studentEmail}/${key}`;
//     } 
//     // For SGPA/CGPA text fields, create a new delete endpoint (handled below)
//     else {
//       url = `/api/result/clearField/${studentEmail}/${key}`;
//     }

//     const res = await fetch(url, { method: "DELETE" });
//     const result = await res.json();

//     if (!res.ok) throw new Error(result.error || "Deletion failed");

//     console.log(`✅ ${key} deleted.`);
//   } catch (err) {
//     console.error(`❌ Failed to delete ${key}:`, err);
//     alert(`Error deleting ${key}: ${err.message}`);
//     return;
//   }
// }


// alert(`${year} marksheets deleted successfully.`);
// // Refresh data
// const newData = await fetch(`/api/result/${studentEmail}`).then(r => r.json());
// displayProfile(newData);
const res = await fetch(`/api/result/clearSection/${studentEmail}/${year}`, {
  method: "DELETE"
});

const result = await res.json();
if (!res.ok) throw new Error(result.error || "Deletion failed");

alert(`${year} academic data deleted successfully.`);

// Refresh data
const newData = await fetch(`/api/result/${studentEmail}`).then(r => r.json());
displayProfile(newData);


          if (!res.ok) throw new Error("Deletion failed");

          alert(`${year} data deleted successfully`);
          // const newData = await fetch(`/api/result/${studentEmail}`).then(r => r.json());
          // displayProfile(newData);
        } catch (err) {
          console.error(err);
          alert("Error deleting data.");
        }
      });
    });
  }

  function generateFileLink(fileObj) {
    if (!fileObj || !fileObj.url) return "<em>No file uploaded</em>";
    return `<a class="file-link" href="${fileObj.url}" target="_blank">${fileObj.originalname}</a>`;
  }
// function generateFileLink(fileObj) {
//   if (!fileObj || !fileObj.url) return "<em>No file uploaded</em>";

//   // ✅ Force inline view (not download)
//   const viewUrl = fileObj.url.replace("/upload/", "/upload/fl_attachment:false/");
  
//   return `<a class="file-link" href="${viewUrl}" target="_blank">${fileObj.originalname}</a>`;
// }


  function openEditForm(year, data) {
    const yearMap = {
      "1st Year": { sgpa1: "sgpa1", sgpa2: "sgpa2", cgpa: "cgpa1", m1: "marksheet1", m2: "marksheet2" },
      "2nd Year": { sgpa1: "sgpa3", sgpa2: "sgpa4", cgpa: "cgpa2", m1: "marksheet3", m2: "marksheet4" },
      "3rd Year": { sgpa1: "sgpa5", sgpa2: "sgpa6", cgpa: "cgpa3", m1: "marksheet5", m2: "marksheet6" },
      "4th Year": { sgpa1: "sgpa7", sgpa2: "sgpa8", cgpa: "cgpa4", m1: "marksheet7", m2: "marksheet8" }
    };

    const keys = yearMap[year];
    if (!keys) return;

    // Create a modal or simple form dynamically (you can style it as needed)
    const formHtml = `
      <form id="editForm" enctype="multipart/form-data">
        <h3>Edit ${year}</h3>
        <label>Semester 1 SGPA: <input type="text" name="${keys.sgpa1}" value="${data[keys.sgpa1] || ''}" required></label><br>
        <label>Semester 1 Marksheet (upload new to replace): <input type="file" name="${keys.m1}" accept=".pdf,.jpg,.png"></label><br>
        <label>Semester 2 SGPA: <input type="text" name="${keys.sgpa2}" value="${data[keys.sgpa2] || ''}" required></label><br>
        <label>Semester 2 Marksheet (upload new to replace): <input type="file" name="${keys.m2}" accept=".pdf,.jpg,.png"></label><br>
        <label>CGPA: <input type="text" name="${keys.cgpa}" value="${data[keys.cgpa] || ''}" required></label><br>
        <input type="hidden" name="studentEmail" value="${studentEmail}">
        <button type="submit">Save</button>
        <button type="button" id="cancelEdit">Cancel</button>
      </form>
    `;

    // Show this form in a modal or replace container content temporarily
    // For simplicity, append form below container:
    let existingForm = document.getElementById("editForm");
    if (existingForm) existingForm.remove();

    const formWrapper = document.createElement("div");
    formWrapper.id = "editFormWrapper";
    formWrapper.innerHTML = formHtml;
    container.appendChild(formWrapper);

    // Cancel button logic
    document.getElementById("cancelEdit").onclick = () => {
      formWrapper.remove();
    };

    // Form submit handler
    document.getElementById("editForm").onsubmit = async function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      try {
        const res = await fetch("/api/result/upload", {
          method: "POST",
          body: formData
        });

        if (!res.ok) throw new Error("Failed to save data");

        const result = await res.json();

        alert("Data updated successfully");
        formWrapper.remove();

        // Refresh displayed data for this student
        fetch(`/api/result/${studentEmail}`)
          .then(res => {
            if (!res.ok) throw new Error("No result found");
            return res.json();
          })
          .then(newData => {
            displayProfile(newData);
          })
          .catch(err => {
            console.error(err);
          });

      } catch (err) {
        alert("Error updating data: " + err.message);
      }
    };
  }
});


///////////////////////////////payment///////////////////////////////////////////////////
           if (!studentEmail) {
  document.getElementById("paymentContainer").innerHTML = "<p>Email not found in localStorage.</p>";
} else {
  fetch(`/api/payment/${studentEmail}`)
    .then(res => {
      if (!res.ok) throw new Error("Failed to fetch");
      return res.json();
    })
    .then(paymentData => {
      const container = document.getElementById("paymentContainer");
      container.innerHTML = ""; // Clear old data

      // Year selector dropdown
      const yearSelector = document.createElement("select");
      yearSelector.innerHTML = `
        <option value="">-- Select Year --</option>
        <option value="year1">YEAR 1</option>
        <option value="year2">YEAR 2</option>
        <option value="year3">YEAR 3</option>
        <option value="year4">YEAR 4</option>
      `;
      container.appendChild(yearSelector);

      const yearContent = document.createElement("div");
      container.appendChild(yearContent);

      yearSelector.addEventListener("change", () => {
        const selectedYear = yearSelector.value;
        yearContent.innerHTML = "";

        if (!selectedYear || !paymentData[selectedYear]) {
          yearContent.innerHTML = "<p>No data found for selected year.</p>";
          return;
        }

        const yearDiv = document.createElement("div");
        yearDiv.className = "year-section";
        yearDiv.innerHTML = `<h3>${selectedYear.toUpperCase()}</h3>`;

        paymentData[selectedYear].forEach((receipt, idx) => {
          const receiptDiv = document.createElement("div");
          receiptDiv.className = "receipt";
          receiptDiv.style.border = "1px solid #ccc";
          receiptDiv.style.padding = "10px";
          receiptDiv.style.marginBottom = "10px";

          const receiptTitle = document.createElement("p");
          receiptTitle.innerHTML = `<strong>Receipt ${idx + 1}</strong>`;

          const fileLink = document.createElement("a");
          fileLink.href = receipt.url;
          fileLink.target = "_blank";
          fileLink.innerText = receipt.originalname || "View Receipt";
          fileLink.style.color = "blue";
          fileLink.style.textDecoration = "underline";

          const fileInput = document.createElement("input");
          fileInput.type = "file";
          fileInput.style.display = "none";

          // Create labeled inputs with spacing
          const paidInput = createLabeledNumberInput("Fees Paid", receipt.paid);
          const waivedInput = createLabeledNumberInput("Total Fees", receipt.waived);
          const penaltyInput = createLabeledNumberInput("Fees Pending", receipt.penalty);

          disableInputs([paidInput.input, waivedInput.input, penaltyInput.input]);

          const editBtn = document.createElement("button");
          const doneBtn = document.createElement("button");
          editBtn.innerText = "Edit";
          doneBtn.innerText = "Done";
          doneBtn.style.display = "none";

          editBtn.onclick = () => {
            enableInputs([paidInput.input, waivedInput.input, penaltyInput.input]);
            fileInput.style.display = "block";
            editBtn.style.display = "none";
            doneBtn.style.display = "inline-block";
          };


doneBtn.onclick = async () => {
  const formData = new FormData();
  formData.append("studentEmail", studentEmail);
  formData.append("year", selectedYear);
  formData.append("index", idx);
  formData.append("paid", paidInput.input.value);
  formData.append("waived", waivedInput.input.value);
  formData.append("penalty", penaltyInput.input.value);
  if (fileInput.files[0]) {
    formData.append("file", fileInput.files[0]);
  }

  try {
    const res = await fetch('/api/payment/update-receipt', {
      method: 'PUT',
      body: formData
    });

    const result = await res.json();
    alert(result.message || "Receipt updated successfully");

    // Update file link if new file was uploaded
    if (result.updatedReceipt && result.updatedReceipt.url && result.updatedReceipt.originalname) {
      fileLink.href = result.updatedReceipt.url;
      fileLink.innerText = result.updatedReceipt.originalname;
    }

    // Disable inputs and toggle buttons
    disableInputs([paidInput.input, waivedInput.input, penaltyInput.input]);
    fileInput.style.display = "none";
    editBtn.style.display = "inline-block";
    doneBtn.style.display = "none";

  } catch (err) {
    console.error("Error updating receipt:", err);
    alert("Failed to update");
  }
};


          receiptDiv.appendChild(receiptTitle);
          receiptDiv.appendChild(fileLink);
          receiptDiv.appendChild(fileInput);
          receiptDiv.appendChild(paidInput.container);
          receiptDiv.appendChild(waivedInput.container);
          receiptDiv.appendChild(penaltyInput.container);
          receiptDiv.appendChild(editBtn);
          receiptDiv.appendChild(doneBtn);

          const deleteBtn = document.createElement("button");
deleteBtn.innerText = "Delete";
deleteBtn.style.marginLeft = "10px";
deleteBtn.onclick = async () => {
  if (!confirm("Are you sure you want to delete this receipt?")) return;

  try {
    const res = await fetch('/api/payment/delete-receipt', {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        studentEmail,
        year: selectedYear,
        index: idx,
      }),
    });

    const result = await res.json();
    alert(result.message || "Receipt deleted");

    // Remove receipt from DOM
    receiptDiv.remove();
  } catch (err) {
    console.error("Error deleting receipt:", err);
    alert("Failed to delete receipt");
  }
};receiptDiv.appendChild(deleteBtn);




          yearDiv.appendChild(receiptDiv);
        });

        yearContent.appendChild(yearDiv);
      });
    })
    .catch(err => {
      console.error("Error fetching payment data:", err);
      document.getElementById("paymentContainer").innerHTML = "<p>Error loading data.</p>";
    });
}

// Helpers
function createLabeledNumberInput(labelText, value) {
  const container = document.createElement("div");
  container.style.margin = "5px 0";

  const label = document.createElement("label");
  label.innerText = labelText + ": ";
  label.style.marginRight = "8px";

  const input = document.createElement("input");
  input.type = "number";
  input.value = value || 0;
  input.disabled = true;
  input.style.width = "100px";

  container.appendChild(label);
  container.appendChild(input);

  return { container, input };
}

function disableInputs(inputs) {
  inputs.forEach(i => i.disabled = true);
}

function enableInputs(inputs) {
  inputs.forEach(i => i.disabled = false);
}

</script>

</body>
</html>
